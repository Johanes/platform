<?xml version="1.0" encoding="ISO-8859-1"?>

<!--
  ~  Copyright (c) 2005-2008, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
  ~
  ~  WSO2 Inc. licenses this file to you under the Apache License,
  ~  Version 2.0 (the "License"); you may not use this file except
  ~  in compliance with the License.
  ~  You may obtain a copy of the License at
  ~
  ~    http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~  Unless required by applicable law or agreed to in writing,
  ~  software distributed under the License is distributed on an
  ~  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  ~  KIND, either express or implied.  See the License for the
  ~  specific language governing permissions and limitations
  ~  under the License.
  ~
  -->

<!DOCTYPE html
   PUBLIC "-//W3C//DTD XHTML 1.1//EN"
   "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd" >

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=iso-8859-1"/>
    <title>
      WSO2 Governance Registry - Setting up Database - MySQL
    </title>
    <link href="../css/greg-docs.css" rel="stylesheet"/>
    <link href="../styles/dist-docs.css" rel="stylesheet" type="text/css" media="all"/>
  </head>
  <body xml:lang="en">
[ <a href="../docs_index.html"> Documentation Index </a> ]
<h1>WSO2 Governance Registry - Setting up Database - MySQL</h1>

<h2>Table of Contents</h2>

<ul>
<li>
<a href="#prepare">Setup Database And The Database User</a>
</li>
<li>
<a href="#conf">Setup Configuration Files</a>
</li>
<li>
<a href="#drivers">Setup Drivers</a>
</li>
<li>
<a href="#createdb">Create Database</a>

<ul>
<li>
<a href="#autodb">Automatic Database Creation</a>
</li>
<li>
<a href="#manualdb">Manual Database Creation</a>
</li>
</ul>
</li>
</ul>



<h2 id="prepare">Setup Database And The Database User</h2>
<ol>
<li>
Download and install MySQL in you computer, if it is not already done.
    And Start the MySQL service.</li>
    <li>
        <p>log in to mysql client using root user (Or any other user with the privilege to create databases).
        </p>
        <p>
        mysql -u root -p
        </p>
        <p>
        You will be prompted to enter the password. (In most systems the default root password is blank. Press enter without typing anything if you haven't changed
the default root password). This will present you the MySQL command prompt.
        </p>
        </li>
        <li>
        <p>
        In the MySQL prompt, create the registry database using the following command.</p>
        <p>
        create database regdb;
        </p>
        </li>
        <li>
        <p>
Now give authorization of the registry database to the user "regadmin".</p>
<p>GRANT ALL ON regdb.* TO regadmin@localhost IDENTIFIED BY "regadmin"</p><p>Now logout from the mysql prompt by typing the "quit" command.</p>
<p>quit;</p>

        </li>
</ol>
<h2 id="conf">Setup Configuration Files</h2>
<ol>
<li>
<p>
Edit the registry.xml file (inside the $GREG_HOME/repository/conf directory) of the deployed registry instance as below. (note the highlighted configurations, You
    may use your own database name, username and password).
</p>
<pre>
    &lt;currentDBConfig&gt;mysql-db&lt;/currentDBConfig&gt;
    &lt;dbConfig name="mysql-db"&gt;
        &lt;url&gt;<strong>jdbc:mysql://localhost:3306/regdb</strong>&lt;/url&gt;
        &lt;userName&gt;<strong>regadmin</strong>&lt;/userName&gt;
        &lt;password&gt;<strong>regadmin</strong>&lt;/password&gt;
        &lt;driverName&gt;<strong>com.mysql.jdbc.Driver</strong>&lt;/driverName&gt;
        &lt;maxActive&gt;<strong>80</strong>&lt;/maxActive&gt;
        &lt;maxWait&gt;<strong>60000</strong>&lt;/maxWait&gt;
        &lt;minIdle&gt;<strong>5</strong>&lt;/minIdle&gt;
    &lt;/dbConfig&gt;
</pre>
<p>
Explanation of the database configuration options.
</p>
<ul>
<li>
url: The URL of the database</li>
<li>
userName: The name of the database user</li>
<li>
password: The password of the database user</li>
<li>
driverName: The class name of the database driver</li>
<li>
maxActive: The maximum number of active connections that can be allocated from this pool at the same time, or negative for no limit. 
</li>
<li>
maxWait: The maximum number of milliseconds that the pool will wait (when there 
    are no available connections) for a connection to be returned before throwing an 
    exception, or &lt;= 0 to wait indefinitely. </li>
<li>
minIdle: The minimum number of active connections that can remain idle in the 
    pool, without extra ones being created, or 0 to create none. </li>
</ul>
</li>
  <li>
    <p>
      Edit the user-mgt.xml file (inside the $GREG_HOME/repository/conf directory) of the deployed instance as below. (note the highlighted configurations, You
    may use your own database name, username and password).
    </p>
<pre>
    &lt;Configuration&gt;
        ...
        &lt;Property name="url"&gt;<strong>jdbc:mysql://localhost:3306/regdb</strong>&lt;/Property&gt;
        &lt;Property name="userName"&gt;<strong>regadmin</strong>&lt;/Property&gt;
        &lt;Property name="password"&gt;<strong>regadmin</strong>&lt;/Property&gt;
        &lt;Property name="driverName"&gt;<strong>com.mysql.jdbc.Driver</strong>&lt;/Property&gt;
        &lt;Property name="maxActive"&gt;<strong>50</strong>&lt;/Property&gt;
        &lt;Property name="maxWait"&gt;<strong>60000</strong>&lt;/Property&gt;
        &lt;Property name="minIdle"&gt;<strong>5</strong>&lt;/Property&gt;
    &lt;/Configuration&gt;
</pre>
  </li>
</ol>

<h2 id="drivers">Setup Drivers</h2>
<ol> 

    <li>
        <p>Download the mysql java connector jar from
        <a href="http://dev.mysql.com/downloads/connector/j/5.1.html">
        http://dev.mysql.com/downloads/connector/j/5.1.html</a> and
Place it in the $GREG_HOME/repository/components/lib directory (Here $GREG_HOME refers to the directory where you run the WSO2 Governance Registry instance).</p>
<p>
<b>Note: </b>Remove old database driver from $GREG_HOME/repository/components/dropins ,when you upgrade the database driver.
</p>
</li>
</ol>

<h2 id="createdb">Create Database</h2>
<h3 id="autodb">Automatic Database Creation</h3>
<ol>
  <li>
    <p>
      Next at the first time you start the registry, run with the -Dsetup option, so
      it will create all the tables in given mysql database.
    </p>

    <p>
      wso2server.sh -Dsetup
     </p>
    <p>
     wso2server.bat -Dsetup
     </p>
  </li>
<li>
You just configured WSO2 Governance Registry to run with MySQL database!
</li>
</ol>
  
<h3 id="manualdb">Manual Database Creation</h3>

<ol>
    <li>
        <p>
Run the MySQL scripts for both registry and user manager (embedded inside the 
    Registry) databases, provided with the WSO2 Governance Registry using the below commands. 
            (outside the mysql prompt)</p>
        <p>
            mysql -u regadmin -p -Dregdb &lt; 'GREG_HOME/dbscripts/mysql.sql';
        </p>
<p> Note: You will be prompted to enter the password for each command.</p>
    </li>
    <li><p>start the wso2 registry instance.</p>
        <p>
            wso2server.sh
        </p>
        <p>
          wso2server.bat
        </p>

        </li>
</ol>
</body>
</html>
