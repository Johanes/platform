<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
~ Copyright (c) 2005-2008, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
~
~ WSO2 Inc. licenses this file to you under the Apache License,
~ Version 2.0 (the "License"); you may not use this file except
~ in compliance with the License.
~ You may obtain a copy of the License at
~
~ http://www.apache.org/licenses/LICENSE-2.0
~
~ Unless required by applicable law or agreed to in writing,
~ software distributed under the License is distributed on an
~ "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
~ KIND, either express or implied. See the License for the
~ specific language governing permissions and limitations
~ under the License.
~
-->
<!DOCTYPE html
   PUBLIC "-//W3C//DTD XHTML 1.1//EN"
   "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd" >
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1"/>
<title>WSO2 Governance Registry - Setting up database - Oracle</title>
<link href="../css/greg-docs.css" rel="stylesheet"/>
<link href="../styles/dist-docs.css" rel="stylesheet" type="text/css" media="all"/>
</head>
<body>
[ <a href="../docs_index.html"> Documentation Index </a> ]
<h1> WSO2 Governance Registry - Setting up database - Oracle </h1>
<h2> Table of Contents </h2>
<div class="toc">
  <ul>
    <li> <a href="#Setup-DB">Setup Database and User</a> </li>
    <li> <a href="#Setup-Conf">Setup Configuration
      File</a> </li>
    <li> <a href="#Copy-Driver">Copy JDBC Driver</a> </li>
    <li> <a href="#Create-Table">Create Database
      Tables</a>
      <ul>
        <li> <a href="#Script">Using Scripts</a> </li>
        <li> <a href="#DSetup">Using start-up
          Parameters</a> </li>
      </ul>
    </li>
  </ul>
</div>
<h2 id="Setup-DB">Setup Database and User</h2>
<p>Create a new database. This can be done by either using oracle db configuration assistant (dbca) or manually. Do necessary changes to oracle tnsnames.ora and listner.ora files in order to define databases addresses for establishing connections to newly created database. After configuring them, connect to oracle as System DBA using SQL*Plus</p>
<pre>$ sqlplus sys/sys-password as sysdba</pre>
<p>Now start-up the oracle instance.</p>
<pre>SQL&gt; start-up </pre>
<p>As SYS DBA Create a database user,and grant privileges to the user as below:</p>
<pre>
Create user USER_NAME identified by PASSWORD account unlock;  
grant connect to USER_NAME;  
grant create session, dba to USER_NAME;  
commit;  	
</pre>
<p>Now exit from SQL*Plus session and start oracle listner </p>
<pre>$ lsnrctl start</pre>
<h2 id="Setup-Conf">Setup Configuration
  File</h2>
<p>Edit $GREG_HOME/repository/conf/registry.xml
  and give the following:</p>
<pre>
    &lt;currentDBConfig&gt;oracle-db&lt;/currentDBConfig&gt;
    &lt;dbConfig name="oracle-db"&gt;
	    &lt;url&gt;<strong>jdbc:oracle:thin:@SERVER_NAME:PORT/DB_NAME</strong>&lt;/url&gt;
	    &lt;userName&gt;<strong>USER_NAME</strong>&lt;/userName&gt;
	    &lt;password&gt;<strong>PASSWORD</strong>&lt;/password&gt;
	    &lt;driverName&gt;<strong>oracle.jdbc.driver.OracleDriver</strong>&lt;/driverName&gt;
        &lt;maxActive&gt;<strong>80</strong>&lt;/maxActive&gt;
        &lt;maxWait&gt;<strong>60000</strong>&lt;/maxWait&gt;
        &lt;minIdle&gt;<strong>5</strong>&lt;/minIdle&gt;
    &lt;/dbConfig&gt;
</pre>
<p>Edit $GREG_HOME/repository/conf/user-mgt.xml
  and give the following:</p>
<pre>
    &lt;Configuration&gt;
        ...
        &lt;Property name="url"&gt;<strong>jdbc:oracle:thin:@SERVER_NAME:PORT/DB_NAME</strong>&lt;/Property&gt;
        &lt;Property name="userName"&gt;<strong>USER_NAME</strong>&lt;/Property&gt;
        &lt;Property name="password"&gt;<strong>PASSWORD</strong>&lt;/Property&gt;
        &lt;Property name="driverName"&gt;<strong>oracle.jdbc.driver.OracleDriver</strong>&lt;/Property&gt;
        &lt;Property name="maxActive"&gt;<strong>50</strong>&lt;/Property&gt;
        &lt;Property name="maxWait"&gt;<strong>60000</strong>&lt;/Property&gt;
        &lt;Property name="minIdle"&gt;<strong>5</strong>&lt;/Property&gt;
    &lt;/Configuration&gt;
</pre>
<p>Default port for oracle is 1521 </p>
<h2 id="Copy-Driver">Copy JDBC Driver</h2>
<p>Copy the oracle jdbc libraries to $GREG_HOME/repository/components/lib. (Ex:- $ORACLE_HOME/jdbc/lib/ojdbc14.jar) </p>
<p>
<b>Note: </b>Remove old database driver from $GREG_HOME/repository/components/dropins ,when you upgrade the database driver.
</p>
<h2 id="Create-Table">Create Database
  Tables</h2>
<p>Database tables can be created either manually by running
  scripts or automatically by using start-up parameters. </p>
<h3 id="Script">Using Scripts </h3>
<p>Database tables can be created manually by logging in to
  created database and running the following scripts</p>
    <p>GREG_HOME/dbscripts/oracle.sql</p>
<h3 id="DSetup">Using start-up Parameters </h3>
<p>Windows users can run $GREG_HOME/bin/wso2server.bat -Dsetup to create the database tables when starting WSO2 Governance Registry for the first time. Linux users should use $GREG_HOME/bin/wso2server.sh -Dsetup </p>
<p> </p>
</body></html>
