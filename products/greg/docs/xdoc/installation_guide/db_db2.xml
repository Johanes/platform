<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
~ Copyright (c) 2005-2008, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
~
~ WSO2 Inc. licenses this file to you under the Apache License,
~ Version 2.0 (the "License"); you may not use this file except
~ in compliance with the License.
~ You may obtain a copy of the License at
~
~ http://www.apache.org/licenses/LICENSE-2.0
~
~ Unless required by applicable law or agreed to in writing,
~ software distributed under the License is distributed on an
~ "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
~ KIND, either express or implied. See the License for the
~ specific language governing permissions and limitations
~ under the License.
~
-->
<!DOCTYPE html
   PUBLIC "-//W3C//DTD XHTML 1.1//EN"
   "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd" >
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1"/>
<title>WSO2 Governance Registry - Setting up database - IBM DB2</title>
<link href="../css/greg-docs.css" rel="stylesheet"/>
<link href="../styles/dist-docs.css" rel="stylesheet" type="text/css" media="all"/>
</head>
<body>
[ <a href="../docs_index.html"> Documentation Index </a> ]
<h1> WSO2 Governance Registry - Setting up database - IBM DB2 </h1>
<h2> Table of Contents </h2>
<div class="toc">
  <ul>
    <li> <a href="#PrepareD">Preparing DB2 Database Server</a> </li>
    <li> <a href="#Setup-DB">Setup Database and Users</a>
      <ul>
        <li> <a href="#CommandPro">Using DB2 Command Processor</a> </li>
        <li> <a href="#ControlC">Using DB2 Control Center</a> </li>
      </ul>
    </li>
    <li> <a href="#Setup-Conf">Setup Configuration Files</a> </li>
    <li> <a href="#Copy-Driver">Setup DB2 jdbc Drivers</a> </li>
    <li> <a href="#Create-Table">Create Database Tables</a>
      <ul>
        <li> <a href="#Script">Using Scripts</a> </li>
        <li> <a href="#DSetup">Using start-up Parameters</a> </li>
      </ul>
    </li>
  </ul>
</div>
<h2 id="PrepareD">Preparing DB2 Database</h2>
<p>Download the latest version of <a href="http://www-01.ibm.com/software/data/db2/express/download.html">DB2 Express-C</a> and install in your computer, if it is not already done. You can find DB2 Express-C Guide from <a href="http://www.ibm.com/developerworks/wikis/display/db2/free+book-+getting+started+with+db2+express-c">here</a>.
</p>
<h2 id="Setup-DB">Setup Database and Users</h2>
<h3 id="CommandPro">Using DB2 Command Processor</h3>
<p>Run DB2 console.</p>
    <pre>Run "db2" in commonad line to open the DB2 console</pre>
   <p></p>
<p>Create database.</p>
    <pre>db2=> create database DB_NAME</pre>
   <p></p>
<p>Before you can issue an SQL statement, you have to connect to a database. To connect to a database:</p>
    <pre>db2=> connect to DB_NAME user USER_NAME using PASSWORD</pre>
   <p></p>
<p>Grant required permissions for users.</p>
    <pre>db2=> connect to DB_NAME
db2=> grant AUTHORITY on database to user USER_NAME

(AUTHORITY : SYSADM,SYSCTRL,SYSMAINT,SYSMON,DBADM or LOAD)
    </pre>
Refer <a href="http://www.ibm.com/developerworks/wikis/display/db2/free+book-+getting+started+with+db2+express-c">DB2 Express-C Guide</a> for more details on DB2 commands.
<h3 id="ControlC">Using DB2 Control Center</h3>
	<p>Open the DB2 control center using the command "db2cc".</p>
	<p>To create a new database, right click the 'All Databases' entry in the Control center tree (inside the object browser) and 
           click 'Create Database-->Standard'. Follow the steps in "Create new Database" wizard.</p>
	<p>Create the new database users from "User and Group Objects" entry for your newly created database.</p>
	<p>Give required permissions to newly created users.</p>
<h2 id="Setup-Conf">Setup Configuration Files</h2>
<p>Edit the registry.xml file(inside the $GREG_HOME/repository/conf directory) of the deployed G-Reg instance as below.(note the highlighted configurations, You may use your own host, database name, username and password).</p>
<pre>
    &lt;currentDBConfig&gt;db2-db&lt;/currentDBConfig&gt;
    &lt;dbConfig name="db2-db"&gt;
        &lt;url&gt;<strong>jdbc:db2://SERVER_NAME:PORT/DB_NAME</strong>&lt;/url&gt;
        &lt;userName&gt;<strong>USER_NAME</strong>&lt;/userName&gt;
        &lt;password&gt;<strong>PASSWORD</strong>&lt;/password&gt;
        &lt;driverName&gt;<strong>com.ibm.db2.jcc.DB2Driver</strong>&lt;/driverName&gt;
        &lt;maxActive&gt;<strong>50</strong>&lt;/maxActive&gt;
        &lt;maxWait&gt;<strong>360000</strong>&lt;/maxWait&gt;
        &lt;minIdle&gt;<strong>5</strong>&lt;/minIdle&gt;
    &lt;/dbConfig&gt;
</pre>
<p>
Explanation of the database configuration options.
</p>
<ul>
<li>
url: The URL of the database</li>
<li>
userName: The name of the database user</li>
<li>
password: The password of the database user</li>
<li>
driverName: The class name of the database driver</li>
<li>
maxActive: The maximum number of active connections that can be allocated from this pool at the same time, or negative for no limit.
</li>
<li>
maxWait: The maximum number of milliseconds that the pool will wait (when there
    are no available connections) for a connection to be returned before throwing an
    exception, or &lt;= 0 to wait indefinitely. </li>
<li>
minIdle: The minimum number of active connections that can remain idle in the
    pool, without extra ones being created, or 0 to create none. </li>
</ul>
<p>Edit the user-mgt.xml file (inside the $GREG_HOME/repository/conf directory) of the deployed G-Reg instance as below.(note the highlighted configurations, You may use your own database name, username and password).</p>
<pre>
    &lt;Configuration&gt;
        ...
        &lt;Property name="url"&gt;<strong>jdbc:db2://SERVER_NAME:PORT/DB_NAME</strong>&lt;/Property&gt;
        &lt;Property name="userName"&gt;<strong>USER_NAME</strong>&lt;/Property&gt;
        &lt;Property name="password"&gt;<strong>PASSWORD</strong>&lt;/Property&gt;
        &lt;Property name="driverName"&gt;<strong>com.ibm.db2.jcc.DB2Driver</strong>&lt;/Property&gt;
        &lt;Property name="maxActive"&gt;<strong>50</strong>&lt;/Property&gt;
        &lt;Property name="maxWait"&gt;<strong>60000</strong>&lt;/Property&gt;
        &lt;Property name="minIdle"&gt;<strong>5</strong>&lt;/Property&gt;
    &lt;/Configuration&gt;
</pre>
<p>Default port for db2 instance is 50000 </p>
<h2 id="Copy-Driver">Setup DB2 jdbc Drivers</h2>
<p>Copy the DB2 jdbc Drivers,</p>
    <pre>db2jcc.jar</pre>
    <pre>db2jcc_license_c0u.jar</pre>
  <p>from $DB2_HOME\SQLLIB\java ($DB2_HOME refers to the installation directory of DB2 Express C)
     to $GREG_HOME/repository/components/lib directory ($GREG_HOME refers to the directory where you run the WSO2 Governance Registry instance).</p>
 <p>
<b>Note: </b>Remove old database driver from $GREG_HOME/repository/components/dropins ,when you upgrade the database driver.
</p>
<h2 id="Create-Table">Create Database Tables</h2>
<p>Database tables can be created either manually by running
  scripts or automatically by using start-up parameters. </p>
<h3 id="Script">Using Scripts </h3>
<p>Database tables can be created manually by executing the following script in DB2 Express C command editor.</p>
    <p>$GREG_HOME/dbscripts/db2.sql</p>
<h3 id="DSetup">Using start-up Parameters </h3>
<p>Database tables can be created, when starting WSO2 Governance Registry for the first time using the startup parameters as follows.</p>
<ul>
    <li>$GREG_HOME/bin/wso2server.bat -Dsetup (in windows)</li>
    <li>$GREG_HOME/bin/wso2server.sh  -Dsetup (in linux)</li>
</ul>
</body>
</html>

