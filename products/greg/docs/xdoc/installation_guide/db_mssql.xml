<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
~ Copyright (c) 2005-2008, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
~
~ WSO2 Inc. licenses this file to you under the Apache License,
~ Version 2.0 (the "License"); you may not use this file except
~ in compliance with the License.
~ You may obtain a copy of the License at
~
~ http://www.apache.org/licenses/LICENSE-2.0
~
~ Unless required by applicable law or agreed to in writing,
~ software distributed under the License is distributed on an
~ "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
~ KIND, either express or implied. See the License for the
~ specific language governing permissions and limitations
~ under the License.
~
-->
<!DOCTYPE html
   PUBLIC "-//W3C//DTD XHTML 1.1//EN"
   "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd" >
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1"/>
<title>WSO2 Governance Registry - Setting up database - MSSQL</title>
<link href="../css/greg-docs.css" rel="stylesheet"/>
<link href="../styles/dist-docs.css" rel="stylesheet" type="text/css" media="all"/>
</head>
<body>
[ <a href="../docs_index.html"> Documentation Index </a> ]
<h1> WSO2 Governance Registry - Setting up database - MSSQL </h1>
<h2> Table of Contents </h2>
<div class="toc">
  <ul>
    <li> <a href="#Setup-DB">Setup Database and User</a>
      <ul>
        <li> <a href="#TCPIP">Enable TCP/IP</a> </li>
        <li> <a href="#Create-DB">Create Database and
          User</a> </li>
        <li> <a href="#Grant">Grant Permission</a> </li>
      </ul>
    </li>
    <li> <a href="#Setup-Conf">Setup Configuration
      File</a> </li>
    <li> <a href="#Copy-Driver">Copy JDBC Driver</a> </li>
    <li> <a href="#Create-Table">Create Database
      Tables</a>
      <ul>
        <li> <a href="#Script">Using Scripts</a> </li>
        <li> <a href="#DSetup">Using start-up
          Parameters</a> </li>
      </ul>
    </li>
  </ul>
</div>
<h2 id="Setup-DB">Setup Database and User</h2>
<h3 id="TCPIP">Enable TCP/IP</h3>
<p>Open "SQL Server
  Configuration Manager" from Start-&gt;Programs-&gt;Microsoft
  SQL Server 2005-&gt;Configuration Tools-&gt; SQL Server
  Configuration Manager. Enable TCP/IP and disable Named Pipes from
  protocols of your MSSQL server. (Note that, in following picture,
  MSSQLSERVER is the name of the SQL server. In your case, the name might
  be different)</p>
<p><img alt="Enable TCP/IP" src="../images/MSSQL1.jpg"/></p>
<p>Open TCP/IP Properties by double clicking "TCP/IP". Set
  "Listen All" to "Yes" in Protocol tab.</p>
<p><img alt="Enable TCP/IP" src="../images/MSSQL2.jpg"/></p>
<p>From IP Address tab, disable "TCP Dynamic Ports" by leaving it
  blank and give a valid "TCP Port" so that MSSQL server will listen in
  that port. (We have used port 1433 in order processor services, so it
  is better to use that port)</p>
<p><img alt="Enable TCP/IP" src="../images/MSSQL3.jpg"/></p>
<p>Similarly, enable TCP/IP from SQL Native Client Configuration
  and disable Named Pipes. Also, check whether the port is set correctly.
  (Port should be 1433)</p>
<p><img alt="Enable TCP/IP" src="../images/MSSQL4.jpg"/></p>
<p><img alt="Enable TCP/IP" src="../images/MSSQL5.jpg"/></p>
<p>After finishing above settings, restart MSSQL Server.</p>
<h3 id="Create-DB">Create Database and
  User</h3>
<p>Open MSSQL Management Studio and creates a database and user </p>
<p><img alt="Create Database" src="../images/CreateDB.jpg"/></p>
<p><img alt="Create User" src="../images/CreateUser.jpg"/></p>
<h3 id="Grant">Grant Permission</h3>
<p>Give required grants/permission to newly created user. Grant
  should allow newly created user to login, create tables, insert data to
  tables in newly created database. </p>
<h2 id="Setup-Conf">Setup Configuration
  File</h2>
<p>Edit $GREG_HOME/repository/conf/registry.xml
  and give the following:</p>
<pre>
    &lt;currentDBConfig&gt;mssql-db&lt;/currentDBConfig&gt;
    &lt;dbConfig name="mssql-db"&gt;
    	&lt;url&gt;<strong>jdbc:jtds:sqlserver://SERVER_NAME:PORT/DB_NAME</strong>&lt;/url&gt;
	    &lt;userName&gt;<strong>USER_NAME</strong>&lt;/userName&gt;
	    &lt;password&gt;<strong>PASSWORD</strong>&lt;/password&gt;
	    &lt;driverName&gt;<strong>net.sourceforge.jtds.jdbc.Driver</strong>&lt;/driverName&gt;
        &lt;maxActive&gt;<strong>80</strong>&lt;/maxActive&gt;
        &lt;maxWait&gt;<strong>60000</strong>&lt;/maxWait&gt;
        &lt;minIdle&gt;<strong>5</strong>&lt;/minIdle&gt;
    &lt;/dbConfig&gt;
</pre>
<p>Edit $GREG_HOME/repository/conf/user-mgt.xml
  and give the following:</p>
<pre>
    &lt;Configuration&gt;
        ...
        &lt;Property name="url"&gt;<strong>jdbc:jtds:sqlserver://SERVER_NAME:PORT/DB_NAME</strong>&lt;/Property&gt;
        &lt;Property name="userName"&gt;<strong>USER_NAME</strong>&lt;/Property&gt;
        &lt;Property name="password"&gt;<strong>PASSWORD</strong>&lt;/Property&gt;
        &lt;Property name="driverName"&gt;<strong>net.sourceforge.jtds.jdbc.Driver</strong>&lt;/Property&gt;
        &lt;Property name="maxActive"&gt;<strong>50</strong>&lt;/Property&gt;
        &lt;Property name="maxWait"&gt;<strong>60000</strong>&lt;/Property&gt;
        &lt;Property name="minIdle"&gt;<strong>5</strong>&lt;/Property&gt;
    &lt;/Configuration&gt;
</pre>
<p>Default port for MSSQL is 1433 </p>
<h2 id="Copy-Driver">Copy JDBC Driver</h2>
<p>Copy MSSQL JDBC driver (jtds-1.2.2.jar) to $GREG_HOME/repository/components/lib (JDBC driver can be downloaded from
  http://jtds.sourceforge.net/)</p>
<p>
<b>Note: </b>Remove old database driver from $GREG_HOME/repository/components/dropins ,when you upgrade the database driver.
</p>
<h2 id="Create-Table">Create Database
  Tables</h2>
<p>Database tables can be created either manually by running
  scripts or automatically by using start-up parameters. </p>
<h3 id="Script">Using Scripts </h3>
<p>Database tables can be created manually by logging in to
  created database and running $GREG_HOME/dbscripts/mssql.sql </p>
<h3 id="DSetup">Using start-up Parameters </h3>
<p>Windows users can run $GREG_HOME/bin/wso2server.bat -Dsetup to create the database tables when starting WSO2 Governance Registry for the first time. Linux users should use $GREG_HOME/bin/wso2server.sh -Dsetup </p>
<p> </p>
</body>
</html>
