<!--
~ Copyright 2005-2008 WSO2, Inc. (http://wso2.com)
~
~ Licensed under the Apache License, Version 2.0 (the "License");
~ you may not use this file except in compliance with the License.
~ You may obtain a copy of the License at
~
~ http://www.apache.org/licenses/LICENSE-2.0
~
~ Unless required by applicable law or agreed to in writing, software
~ distributed under the License is distributed on an "AS IS" BASIS,
~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
~ See the License for the specific language governing permissions and
~ limitations under the License.
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
        "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <link href="css/mashup-docs.css" rel="stylesheet" type="text/css" media="all"/>
</head>

<body>

<div id="main-content">
<h1>Identity Management</h1>

<p>The WSO2 Mashup Server utilizes the WSO2 <a
href="http://wso2.org/project/solutions/identity/1.5/docs/">Identity
Solution</a> to provide two user friendly means of authentication in addition
to the traditional User ID and Password based login. Both OpenID and InfoCard
are fast becoming preferred means of authentication for users frustrated and
concerned by the need to remember and manage User ID and Password
combinations for an increasing number of web sites and services that require
authentication.</p>

<p>You can enable both OpenID and InfoCard based authentication for users
registering on your WSO2 Mashup Server by updating your server installation
as described below.</p>

<h1>OpenID</h1>
<img src="images/openid-logo.jpg" alt=""/> 

<h2>Preparing the Server</h2>

<p>If you have already setup the 'webapp_url' parameter in the
lib/tomcat/webapps/ROOT/WEB-INF/web.xml file as shown below, when enabling
self registration, your Mashup Server is ready to allow OpenID based
authentication.</p>

<p class="Code">&lt;init-param&gt;<br/>
&#xa0;&#xa0;&lt;param-name&gt;webapp_url&lt;/param-name&gt;<br/>
&#xa0;&#xa0;&lt;param-value&gt;https://<strong>mydomain</strong>/&lt;/param-value&gt;<br/>
&lt;/init-param&gt;<br/>
</p>
<br/>


<h2>Using OpenID</h2>

<p>Simply attempting to Login with an unregistered OpenID will trigger the
self registration process, if internet guests are allowed on your server. The
initial page displayed will warn you that you are attempting to use an
unregistered OpenID to login and request confirmation to register this OpenId
on the site.</p>
<img src="images/openid_selfreg_url.png" alt=""/>

<p>Once you click on 'Register', the Mashup Server will retrieve your full
name, nickname and e-mail ID from your identity provider and display this
information in a confirmation page, requesting you to complete any required
details that were not made available. Clicking on the 'Register' link here
will initiate the standard e-mail ID verification process, after which you
may Login using your newly registered OpenID.</p>
<img src="images/openid_details_verify.png" alt=""/>

<h3>Associating an OpenID with an Existing Profile</h3>

<p>Clicking on the 'Register your OpenID' link will bring up a text field
into which you can enter the URL of the OpenID that you wish to associate
with your current profile. Clicking on the 'Add' button will complete the
association, after which you can Login using this ID.</p>

<p><img src="images/openid_associate.png" alt="Associate OpenId"/> </p>

<h1>InfoCard</h1>

<p><img src="images/infocard_92x64.png" alt=""/> </p>

<h2>Preparing the Server</h2>

<p>1. To use InfoCards for authentication, the JDK on your mashup server
needs to include the 'Java Cryptography Extension (JCE) Unlimited Strength
Jurisdiction Policy Files' which can be found, along with installation
instructions, on the download page for your JDK. The policy file for JDK 1.6
can be found <a
href="https://cds.sun.com/is-bin/INTERSHOP.enfinity/WFS/CDS-CDS_Developer-Site/en_US/-/USD/ViewProductDetail-Start?ProductRef=jce_policy-1.6.0-oth-JPR@CDS-CDS_Developer">here</a>.
Typically, just copying the local_policy.jar and US_export_policy.jar files
from the downloaded zip file to the /jre/lib/security directory of your JDK,
overwriting the two existing files, is all you need to do. </p>

<p>2. A keystore needs to be configured on your server. The default
configuration and keystore that ships with the Mashup Server will be
sufficient for testing CardSpace on your local system, but if you wish to
deploy the Mashup Server in a production environment, you need to obtain a
valid certificate. The parameters hightlighted below need to be changed to
match the valid certificate that you will have obtained for your domain
before you can allow users to authenticate via InfoCards.</p>

<p><strong>The [Mashup Home]/lib/tomcat/webapps/ROOT/WEB-INF/web.xml file
needs to have the keystore information updated.</strong></p>

<p class="Code">&lt;init-param&gt;<br/>
&#xa0;&#xa0;&lt;param-name&gt;Keystore&lt;/param-name&gt;<br/>
&#xa0;&#xa0;&lt;param-value&gt;../../../../conf/<strong>mykeystore</strong>.jks&lt;/param-value&gt;<br/>
&lt;/init-param&gt;<br/>
&lt;init-param&gt;<br/>
&#xa0;&#xa0;&lt;param-name&gt;StorePass&lt;/param-name&gt;<br/>
&#xa0;&#xa0;&lt;param-value&gt;<strong>mykeystorepassword</strong>&lt;/param-value&gt;<br/>
&lt;/init-param&gt;<br/>
&lt;init-param&gt;<br/>
&#xa0;&#xa0;&lt;param-name&gt;KeyAlias&lt;/param-name&gt;<br/>
&#xa0;&#xa0;&lt;param-value&gt;<strong>myalias</strong>&lt;/param-value&gt;<br/>
&lt;/init-param&gt;<br/>
&lt;init-param&gt;<br/>
&#xa0;&#xa0;&lt;param-name&gt;KeyPass&lt;/param-name&gt;<br/>
&#xa0;&#xa0;&lt;param-value&gt;<strong>mykeypass</strong>&lt;/param-value&gt;<br/>
&lt;/init-param&gt;<br/>
</p>

<p><strong>This change has to also be carried out in the [Mashup
Home]/conf/axis2.xml file, by updating the values highlighted
below.</strong></p>

<p class="Code">&lt;parameter name="keystore"&gt;<br/>
&#xa0;&#xa0;&lt;wso2wsas:KeyStore
xmlns:wso2wsas="http://www.wso2.org/products/wsas"&gt;<br/>
&#xa0;&#xa0;&lt;!-- Keystore file location--&gt;<br/>
&#xa0;&#xa0;&lt;wso2wsas:Location&gt;conf/<strong>mykeystore</strong>.jks&lt;/wso2wsas:Location&gt;<br/>
&#xa0;&#xa0;&lt;!-- Keystore type (JKS/PKCS12 etc.)--&gt;<br/>
&#xa0;&#xa0;&lt;wso2wsas:Type&gt;JKS&lt;/wso2wsas:Type&gt;<br/>
&#xa0;&#xa0;&lt;!-- Keystore password--&gt;<br/>
&#xa0;&#xa0;&lt;wso2wsas:Password&gt;<strong>mykeystorepassword</strong>&lt;/wso2wsas:Password&gt;<br/>
&#xa0;&#xa0;&lt;/wso2wsas:KeyStore&gt;<br/>
&lt;/parameter&gt;<br/>
</p>
<br/>


<h2>Preparing the Client</h2>

<p>1. Windows/IE users should download the Microsoft .NET Framework 3.0
Redistributable Package from <a
href="http://www.microsoft.com/downloads/details.aspx?familyid=10cc340b-f857-4a14-83f5-25634c3bf043&amp;displaylang=en">here</a>
and install it to setup the CardSpace selector in your Windows based client.
Also, please make sure you're running MSIE 7.0 or newer.</p>

<p>2. Firefox user can use an Identity selector plugin of their choice.</p>

<p>3. If you are using the certificate that was shipped with the Mashup
Server, or another certificate from an untrusted CA for your testing, you
will need to trust the certificate of the root CA or the Identity Selector
will display an error saying it cannot verify the identity of the site.</p>
<ul>
  <li>On MSIE, right click on the self registration or profile page, before
    you chose to submit your InfoCard </li>
  <li>Select Properties --&gt; Certificates --&gt; Certification Path </li>
  <li>Select the certificate of the root CA </li>
  <li>View Certificate </li>
  <li>Install </li>
</ul>

<h2>Using InfoCard</h2>

<p>As a user, you can either register yourself using your InfoCard directly,
or register using a username and password, and associate your InfoCard with
this profile later on. </p>

<h3>Self Registration with InfoCard </h3>

<p>When the 'Get details from my personal or Managed InfoCard' image is
clicked, you will be shown the IdentitySelector, from whcih you need to
select the InfoCard that you plan to use to register on the Mashup Server.</p>

<p><img alt="Self Registration" src="images/Self_Registration.png"
width="1009" height="707"/><br/>
<br/>
Once you send the card across, the server will extract the required claims
from the information supplied by the InfoCard and display them for
verification, while requesting you to enter a username, based on which the
server will create your profile and script directory. After the standard
e-mail ID verification step is complete, you may login using your InfoCard
and associate other InfoCards, OpenID's or even a password with your
profile.</p>

<h3>Associating an InfoCard with an Existing Profile</h3>

<p>The 'Management Tasks' pane of the profile page contains a link to
'Register your InfoCard'. This can be used as many times as necessary, to
associate as many cards as you require with your profile. Simply click on the
link, select the card to be associated in your Identity Selector and send.
The next time you access your profile, you will see the list of associated
cards displayed.</p>

<p><img alt="User Profile" src="images/User_Profile.png" width="1005"
height="650"/><br/>
</p>

<h1>Further Reading</h1>

<p>For more details on OpenID and the advantages of using OpenID based
authentication on your Mashup Server, please refer to <a
href="http://wso2.org/library/3593">this article</a> on the WSO2 Oxygen
Tank.</p>

<p>For an introduction to Windows CardSpace, read <a
href="http://msdn.microsoft.com/en-us/netframework/cc196951.aspx">this
article</a> at MSDN, which also contains a link to the CardSpace community
site, from where you can get access to a host of other resources InfoCard.</p>
</div>

</body>
</html>
