<%
        var config = {};

        var db = new Database("jdbc:mysql://localhost:3306/bamwebappstats",
        "root", "root123", config);
    	var result = db.query("select * from WEBAPP_REQUEST_SUMMARY;");

        db.close();

        var respJson = null;

        var colx = "appName";
    	var coly = "total_request_count";

    	function convertDBResult(result, colx, coly) {
			var array = [];
			for (var i = 0; i < result.length; i++) {
				// print("The " + i + "th result is : " + result[i]);
				array.push([result[i][colx],parseFloat(result[i][coly])]);
			}

			return array;
        };
        respJson = convertDBResult(result, colx, coly);

//        print(respJson);
%>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link href="../jqPlot/jquery.jqplot.min.css" type="text/css" rel="stylesheet"/>
    <script src="../scripts/jquery-1.7.2.min.js" type="text/javascript"></script>
    <script src="../jqPlot/jquery.jqplot.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="../jqPlot/plugins/jqplot.categoryAxisRenderer.js"></script>
    <script type="text/javascript" src="../jqPlot/plugins/jqplot.barRenderer.js"></script>
    
<!--[if lt IE 9]><script language="javascript" type="text/javascript" src="../jqPlot/excanvas.min.js"></script><![endif]-->
<script lang="javascript" type="text/javascript">
    $(document).ready(function () {
            var respJson = <%=respJson%>;

            var widthToHeightRatio = 325/250;
            var width = 450;
//            var width = gadgets.window.getViewportDimensions()["width"];
            var height = (width/widthToHeightRatio);

            $("#ui-element").width(width);
            $("#ui-element").height(height);

            var plot = null;
	
            update();
            setInterval(update, 60 * 1000 );

            function update() {

        $("#ui-element").html('');
        plot = $.jqplot('ui-element', [respJson], {
                    title: 'Request Count per Web Application ',
                    series:[{renderer:$.jqplot.BarRenderer}],
                    axes: {
                        xaxis: {
                            renderer: $.jqplot.CategoryAxisRenderer,
                            label: 'Webapp name',
                            // labelRenderer: $.jqplot.CanvasAxisLabelRenderer,
                            tickRenderer: $.jqplot.CanvasAxisTickRenderer,
                            tickOptions: {
                                enableFontSupport: true,
                                angle: -30
                            }

                        },
                        yaxis: {
                            autoscale:true,
                            label: 'No. of Requests',
                            // labelRenderer: $.jqplot.CanvasAxisLabelRenderer,
                            tickRenderer: $.jqplot.CanvasAxisTickRenderer,
                            tickOptions: {
                                enableFontSupport: true,
                                angle: -30
                            }
                        }
                    }
                });
                plot.replot();
    
        
//                gadgets.window.adjustHeight();
            };
        });
    </script>
</head>

<body>
    <div id="ui-element" style="width: 325px; height: 250px;"/>
    <div id="text1"/>
</body>
</html>
