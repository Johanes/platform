<!--
 ~ Copyright (c) 2009-2010, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
 ~
 ~ Licensed under the Apache License, Version 2.0 (the "License");
 ~ you may not use this file except in compliance with the License.
 ~ You may obtain a copy of the License at
 ~
 ~      http://www.apache.org/licenses/LICENSE-2.0
 ~
 ~ Unless required by applicable law or agreed to in writing, software
 ~ distributed under the License is distributed on an "AS IS" BASIS,
 ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 ~ See the License for the specific language governing permissions and
 ~ limitations under the License.
-->
<analyzerSequence name="APIVersionServiceTimeSummarySequence">
   <trigger cron="1 * * * * ? *"/>
   <analyzers>
      <get name="BASEEnriched" batchSize="1000">
      </get>
      <groupBy>
         <field name="api"/>
         <field name="version"/>
      </groupBy>
      <drop type="column">
         <fieldSet>
            <field name="consumerKey"/>
            <field name="api_version"/>
            <field name="context"/>
            <field name="resource"/>
            <field name="method"/>
            <field name="userId"/>
	    <field name="request"/>
	    <field name="requestTime"/>
	    <field name="response"/>
	    <field name="responseTime"/>
         </fieldSet>
      </drop>
      <aggregate>
         <measure name="serviceTime" aggregationType="AVG"/>
      </aggregate>
      <put name="APIVersionServiceTimeSummaryTable" dataSourceType="CASSANDRA">
         <onExist>
            <aggregate>
               <measure name="serviceTime" aggregationType="AVG"/>
            </aggregate>
         </onExist>
      </put>
   </analyzers>
</analyzerSequence>